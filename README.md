# NUCLEO-F446RE FreeRTOS CLI Playground

Embedded â€œcomebackâ€ project built on the STM32 NUCLEO-F446RE board using  
**FreeRTOS**, **interrupt-driven UART**, and a **queue-based command line interface**.

The goal of this project is to rebuild embedded confidence with a clean,  
professional-style firmware architecture:

- FreeRTOS (CMSIS-RTOS v2)
- Queue-based UART CLI (ISR â†’ message queue â†’ CLI task)
- Thread-safe UART logging via mutex
- Virtual temperature sensor module
- Optional periodic logging using a hardware timer (TIM2)
- Clear separation between HAL init, RTOS objects, and application logic

---

## Features

- ğŸ§µ **Three FreeRTOS tasks**
  - `LEDTask` â€“ blinks the on-board LED (LD2) as a heartbeat
  - `SensorTask` â€“ reads a virtual temperature sensor and logs values
  - `CLITask` â€“ handles UART CLI input using a message queue

- ğŸ” **Interrupt-driven UART RX**
  - Uses `USART2` on the NUCLEO-F446RE (ST-Link Virtual COM Port)
  - RX is done with `HAL_UART_Receive_IT`
  - `HAL_UART_RxCpltCallback()` pushes bytes into an RTOS queue (no heavy work in ISR)

- ğŸ’¬ **Simple UART CLI**
  - Single-character commands handled in `CLITask`
  - Commands:
    - `h` â€“ print help
    - `t` â€“ toggle LED
    - `s` â€“ print system status
    - `r` â€“ read virtual sensor value once
    - `l` â€“ start periodic logging (timer-based)
    - `x` â€“ stop periodic logging

- ğŸ”’ **Mutex-protected UART logging**
  - All UART prints from tasks go through `uart_print()` / `uart_write_char()`
  - A FreeRTOS mutex (`uartMutex`) ensures TX operations are thread-safe
  - No interleaved or garbled logs even with multiple tasks printing

- ğŸ“ˆ **Virtual sensor module**
  - `sensor.c / sensor.h` provide:
    - `sensor_init()`
    - `sensor_read_raw()` â€“ fake raw value in tenths of Â°C
    - `sensor_read_celsius()` â€“ floating-point Â°C value
  - Values change over time using `HAL_GetTick()` to simulate real data

- â±ï¸ **Timer-driven logging (optional)**
  - TIM2 interrupt (`HAL_TIM_PeriodElapsedCallback`) can emit `LOG:` lines
  - Controlled via CLI commands `l` (start) and `x` (stop)

---

## Hardware

- **Board**: STM32 NUCLEO-F446RE  
- **MCU**: STM32F446RE (ARM Cortex-M4F)  
- **UART**: `USART2` via ST-Link Virtual COM Port  
- **LED**: `LD2` (PA5)

No external sensors are required because the temperature sensor is emulated in software.

---

## Toolchain / IDE

- **IDE**: STM32CubeIDE (CMake project)
- **HAL**: STM32Cube HAL
- **RTOS**: FreeRTOS via CMSIS-RTOS v2 wrapper
- **Language**: C

---

## Project Structure (high level)

```text
Core/
  Inc/
    main.h
    sensor.h
  Src/
    main.c        <- HAL init + RTOS init + tasks + CLI
    sensor.c      <- virtual sensor implementation
Drivers/
Middlewares/
  Third_Party/
    FreeRTOS/    <- FreeRTOS sources (generated by Cube)
*.ioc            <- STM32CubeMX configuration file
